---
AWSTemplateFormatVersion: '2010-09-09'
Description: >
  Add Description Here.

# ------------------------------------------


# ==========================================
Metadata: {}
# Metadata:


# ==========================================
# Parameters {}
Parameters:

  # ------------------------------------------
  # --- The Project Name
  ProjectName:
    Description: "The Name given to this Project."
    ConstraintDescription: "Specify Project Name"
    Type: String
    Default: "cfn-bckt-www-cli"
    MinLength: 3
    MaxLength: 63
    AllowedPattern:
      (?!^(\d{1,3}\.){3}\d{1,3}$)(^[a-z0-9]([a-z0-9-]*(\.[a-z0-9])?)*$(?<!\-))

  # ------------------------------------------
  # --- The Hosted Zone Domain Name
  DomainBaseURL:
    Description: "Domain Base URL Hosted Zone Apex"
    Type: String
    Default: "cloudemprise.net"
    AllowedPattern:
      ^(([a-zA-Z]{1})|([a-zA-Z]{1}[a-zA-Z]{1})|([a-zA-Z]{1}[0-9]{1})|([0-9]{1}[a-zA-Z]{1})|([a-zA-Z0-9][a-zA-Z0-9-_]{1,61}[a-zA-Z0-9]))\.([a-zA-Z]{2,6}|[a-zA-Z0-9-]{2,30}\.[a-zA-Z]{2,3})$


# ==========================================
Conditions: {}
# Conditions:


# ==========================================
Resources:


  # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  #         S3 BUCKET DEFINITION
  # ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


  # ------------------------------------------
  # --- Root Bucket Definition
  BucketRootDomain:
    Type: AWS::S3::Bucket
    # .............................
    Properties:
      # .............................
      BucketName: !Sub "${DomainBaseURL}"
      AccessControl: PublicRead
      # .............................
      WebsiteConfiguration: 
        IndexDocument: "index.html"
        ErrorDocument: "error.html"
      # .............................
      LoggingConfiguration: 
        DestinationBucketName: !Ref BucketLogs
        LogFilePrefix: "logs/"
      # .............................
      Tags:
        -
          Key: "Project"
          Value: !Sub "${ProjectName}"

  # ------------------------------------------
  # --- Logs Bucket Definition
  BucketLogs:
    Type: "AWS::S3::Bucket"
    # .............................
    Properties:
      # .............................
      BucketName: !Sub "logs.${DomainBaseURL}"
      AccessControl: LogDeliveryWrite
      # .............................
      BucketEncryption: 
        ServerSideEncryptionConfiguration: 
        - 
          ServerSideEncryptionByDefault: 
            SSEAlgorithm: "AES256"
      # .............................
      Tags:
        -
          Key: "Project"
          Value: !Sub "${ProjectName}"

  # ------------------------------------------
  # --- Redirect Bucket Definition
  BucketWwwRedirect:
    Type: AWS::S3::Bucket
    # .............................
    Properties:
      # .............................
      BucketName: !Sub "www.${DomainBaseURL}"
      AccessControl: BucketOwnerFullControl
      # .............................
      WebsiteConfiguration:
        RedirectAllRequestsTo:
          HostName: !Sub "${DomainBaseURL}"
      # .............................
      Tags:
        -
          Key: "Project"
          Value: !Sub "${ProjectName}"

# ==========================================
# Outputs: {}
Outputs:

  # ------------------------------------------
  # --- Website URL
  BucketRootDomainURL:
    Description: "The URL of Static Website."
    Value: !GetAtt BucketRootDomain.WebsiteURL
  # ------------------------------------------
  # --- S3 Website Bucket IPv4 DNS
  BucketRootDomainDNS:
    Description: "The IPv4 Root Bucket DNS."
    Value: !GetAtt BucketRootDomain.DomainName
  # ------------------------------------------
  # --- S3 Logs Bucket IPv4 DNS
  BucketLogsDNS:
    Description: "The IPv4 Logs Bucket DNS."
    Value: !GetAtt BucketLogs.DomainName
